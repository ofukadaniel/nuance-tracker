(function() {
  // Helpers
  const $ = (id) => document.getElementById(id);
  const clamp = (v, min, max) => Math.min(max, Math.max(min, v));
  const LS_KEY = "nuance_tracker_v2_full";

  // --- Initial State ---
  let state = loadState();

  function loadState() {
    const saved = localStorage.getItem(LS_KEY);
    return saved ? JSON.parse(saved) : defaultState; // Reference your defaultState object here
  }

  function saveState() {
    localStorage.setItem(LS_KEY, JSON.stringify(state));
  }

  // --- Scoring Logic ---
  function computeScores() {
    let totalPerfWeight = 0;
    let earnedPerfPoints = 0;

    // Process Sliders
    state.catalogs.sliders.filter(s => s.onDashboard).forEach(slider => {
        const val = state.sliderValues[slider.id] || 0;
        const completion = (val - slider.min) / (slider.max - slider.min);
        totalPerfWeight += slider.perfWeight;
        earnedPerfPoints +=
